jobs:
  - name: man-prod9
    type: manifest
    steps:
      - IN: nginx-prod9
      - TASK: managed

  - name: man-prod11
    type: manifest
    steps:
      - IN: nginx-prod11
      - TASK: managed

  - name: man-prod10
    type: manifest
    steps:
      - IN: nginx-prod10
      - IN: replicas
      - IN: params
      - IN: dockerOptions      
      - TASK: managed

  - name: azure
    type: deploy
    method: upgrade
#    workflow: parallel
    steps:
      - IN: man-prod9
      - IN: man-prod11
      - IN: azure-cluster
      - TASK: managed
#        deployMethod: blueGreen
        deployOptions: 
          - parallel


resources:
  - name: nginx-prod10
    type: image
    integration: "docker-subint"
    pointer:
      sourceName: "ankul/nginx"
    seed:
      versionName: prod.10

  - name: nginx-prod11
    type: image
    integration: "docker-subint"
    pointer:
      sourceName: "ankul/nginx"
    seed:
      versionName: prod.11

  - name: nginx-prod9
    type: image
    integration: "docker-subint"
    pointer:
      sourceName: "ankul/nginx"
    seed:
      versionName: prod.9

  - name: replicas
    type: replicas
    version:
      count: 2

  - name: params
    type: params
    version:
      params:
        API_URL: https://localhost:3000
        WWW_URL: https://localhost:8080

  - name: dockerOptions
    type: dockerOptions
    version:
      portMappings:
        - "80:80/tcp"

  - name: azure-cluster
    type: cluster
    integration: azure-subint  
